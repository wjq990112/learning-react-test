## å‰è¨€

> å¯¹ä¸èµ·ï¼Œé¸½äº†å¾ˆä¹…çš„å®æˆ˜ç»ˆäºå‡ºæ¥äº†ï¼
>
> è¿™ç¯‡æ–‡ç« æ˜¯å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ç³»åˆ—çš„ `React` å®æˆ˜éƒ¨åˆ†ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ç³»åˆ—ä¼šä»ç†è®ºèµ°å‘å®è·µï¼ŒçœŸæ­£å¸¦é¢†å¤§å®¶å­¦ä¼šä½¿ç”¨å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œå¹¶èƒ½åœ¨ä¸šåŠ¡ä¸­è½åœ°ã€‚
>
> çœ‹å®Œæ•´ä¸ªç³»åˆ—ï¼Œè¿˜ä¸ä¼šä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ä¸ºç”Ÿäº§ææ•ˆï¼Œè¯·æ¥æ‰¾æˆ‘ï¼
>
> è€è§„çŸ©ï¼Œç‚¹èµè¿‡ä¸¤ç™¾ï¼ŒæŒç»­æ›´æ–° `Vue` ä¸è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç»“åˆæ•™ç¨‹ã€‚
>
> å…³æ³¨ **ã€ŒHello FEã€** è·å–æ›´å¤šç®€å•æ˜“æ‡‚çš„å®æˆ˜æ•™ç¨‹ã€‚

**æœ¬æ–‡ä¸ºå®æˆ˜æ•™ç¨‹ï¼Œè‹¥æ–‡ä¸­ç†è®ºçŸ¥è¯†å­˜åœ¨é”™è¯¯ï¼Œæ¬¢è¿å¤§ä½¬åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼**

ç»è¿‡äº†ä¸Šä¸€ç¯‡æ–‡ç« çš„ç§‘æ™®ï¼Œå¤§å®¶åº”è¯¥éƒ½å¯¹å‰ç«¯çš„è‡ªåŠ¨åŒ–æµ‹è¯•æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚

æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« å¯¹è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³æ¦‚å¿µå’Œ Jest åŸºç¡€è¯­æ³•çš„åŒå­¦å¯ä»¥ç‚¹å‡»ä¼ é€é—¨ï¼š[ã€Šä¸æƒ³ç—›å¤±è–ªèµ„æ™®è°ƒå’Œå¹´ç»ˆå¥–ï¼Ÿè¯•è¯•è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ï¼ˆåŸºç¡€ç¯‡ï¼‰ã€‹](https://juejin.im/post/5eeae4f7e51d4574195ed982)

**å¸Œæœ›å¤§å®¶éƒ½èƒ½å…ˆæ‰“å¥½åŸºç¡€å†å¼€å§‹å®æˆ˜çš„éƒ¨åˆ†ï¼**

å®æˆ˜éƒ¨åˆ†çš„ä»£ç æˆ‘æ”¾åœ¨äº†æˆ‘çš„ Git ä»“åº“ï¼š[wjq990112 / Learing-React-Test](https://github.com/wjq990112/Learing-React-Test)ï¼Œæ¬¢è¿å¤§å®¶ç‚¹ä¸ªå°æ˜Ÿæ˜Ÿ â­ï¸ï¼ŒæŒç»­å…³æ³¨åç»­æ›´æ–°~

## å‰ç½®çŸ¥è¯†

**æˆ‘å¸Œæœ›ä½ æœ‰ä¸€ç‚¹ç‚¹çš„è‹±æ–‡æ–‡æ¡£é˜…è¯»èƒ½åŠ›**

ç”±äºå›½å†…å¯¹äºå‰ç«¯è‡ªåŠ¨åŒ–çš„å®è·µä¸å¤šï¼Œç›¸å…³ä»‹ç»çš„æ–‡ç« ä¹Ÿå¾ˆå°‘ï¼Œä¸­æ–‡èµ„æ–™åŒ®ä¹ï¼Œå¾ˆå¤šåº“ç±»åªèƒ½é€šè¿‡å»é˜…è¯»è‹±æ–‡å®˜æ–¹æ–‡æ¡£æ¥å­¦ä¹ ä½¿ç”¨ã€‚å½“ç„¶ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä¼šå°½é‡ç»™å¤§å®¶å°†è‹±æ–‡æ–‡æ¡£ä¸­**æ¯”è¾ƒåŸºç¡€æ¯”è¾ƒé‡è¦**çš„éƒ¨åˆ†è®²è§£ä¸€ä¸‹ã€‚

**æˆ‘å¸Œæœ›ä½ æœ‰ä¸€ç‚¹ç‚¹çš„ `React` åŸºç¡€**

æ—¢ç„¶æ˜¯ä¸ `React` ç»“åˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•å®æˆ˜ï¼Œé‚£ä¹ˆ `React` çš„åŸºæœ¬ç”¨æ³•æ˜¯å¿…çŸ¥å¿…ä¼šçš„æ¬§ï¼Œå¦‚æœ `React` è¿˜ä¸ä¼šçš„åŒå­¦ï¼Œå¯ä»¥å»è´­ä¹° [@ç¥ä¸‰å…ƒ](https://juejin.im/user/5c45ddf06fb9a04a006f5491)ï¼ˆä¸‰å…ƒè®°å¾—æ‰“é’± ğŸ¶ï¼‰ çš„å°å†Œï¼š[ã€ŠReact Hooks ä¸ Immutable æ•°æ®æµå®æˆ˜ã€‹](https://juejin.im/book/5da96626e51d4524ba0fd237)ï¼Œçœ‹å®Œä½ ä¹Ÿèƒ½æˆä¸º `React` é«˜æ‰‹ã€‚

**æˆ‘å¸Œæœ›ä½ æœ‰ä¸€ç‚¹ç‚¹çš„ TypeScript åŸºç¡€**

è™½ç„¶æˆ‘åœ¨å®æˆ˜ä¸­ä¼šå°½é‡å‡å°‘ä½¿ç”¨ TypeScript çš„è¯­æ³•ï¼Œä½†éƒ¨åˆ†ä»£ç ç”¨åˆ°çš„æ—¶å€™ä¸è¦ä¸€å¤´é›¾æ°´ä¸çŸ¥æ‰€äº‘æ¬§ï¼

**æˆ‘å¸Œæœ›ä½ æœ‰ä¸€å®šçš„å·¥ç¨‹åŒ–èƒ½åŠ›**

è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯ä¸€ä¸ªå·¥ç¨‹é—®é¢˜ï¼Œå¯¹è¿™æ–¹é¢ä¸€å®šè¦æœ‰ä¸€å®šçš„äº†è§£æ‰è¡Œã€‚æ–‡ç« ä¸­ä¼šæ¶‰åŠåˆ°ä¸€äº› `babel.config.js`ã€`jest.config.js` ç­‰é…ç½®æ–‡ä»¶çš„é…ç½®å’Œè®²è§£ï¼Œæ²¡æœ‰é…ç½®åŸºç¡€çš„åŒå­¦å¯ä»¥å…ˆè·Ÿç€æ–‡ç« çš„å†…å®¹å­¦ä¹ ï¼Œåç»­ä¸€å®šè¦è‡ªå·±é˜…è¯»ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ï¼

## å‡†å¤‡å·¥ä½œ

### æ–¹æ³•ä¸€

**å¼ºçƒˆå»ºè®®å¤§å®¶è·Ÿç€æ–¹æ³•ä¸€ä¸€æ­¥ä¸€æ­¥æ­å»ºå¥½æˆ‘ä»¬çš„å®æˆ˜ç¯å¢ƒï¼**

å¤§å®¶å¯ä»¥ä½¿ç”¨ `create-react-app` è‡ªå·±åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä¸¤ç§æ–¹å¼åˆ›å»ºï¼š

```bash
npx create-react-app jest-react --template-typescript
```

æˆ–è€…ï¼š

```bash
npm install create-react-app -g
create-react-app jest-react --template-typescript
```

åˆ›å»ºå¥½é¡¹ç›®åï¼Œå°±å¯ä»¥å¼€å§‹å°è¯•ä¸€ä¸‹è‡ªåŠ¨åŒ–æµ‹è¯•å’Œ `React` çš„ç»“åˆçš„ç¥å¥‡æ•ˆæœäº†ï¼

### æ–¹æ³•äºŒ

æ–¹æ³•ä¸€å¦‚æœå¤§å®¶è§‰å¾—éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä» GitHub æ‹‰æˆ‘çš„ä»£ç ä¸‹æ¥ï¼Œé€‰æ‹©å¯¹åº”æ•™ç¨‹çš„åˆ†æ”¯ï¼š

```bash
# åŸºç¡€æ•™ç¨‹
git checkout base
# è¿›é˜¶æ•™ç¨‹: testing-library
git checkout advance/testing-library
# è¿›é˜¶æ•™ç¨‹: enzyme
git checkout advance/enzyme
```

ç„¶åæ‰§è¡Œï¼š

```bash
npm install
npm run start
```

æœåŠ¡è·‘åœ¨ [http://localhost:3000](http://localhost:3000)ï¼Œä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼ŒæœåŠ¡å¯åŠ¨å®Œæˆä¹‹åå°±èƒ½çœ‹åˆ°å®æˆ˜é¡¹ç›®çš„ç•Œé¢å•¦ï¼

å½“ç„¶ï¼Œæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯ä¸ºäº†è®²è§£è‡ªåŠ¨åŒ–æµ‹è¯•çš„ï¼Œç•Œé¢å°±æ²¡åšé‚£ä¹ˆæ¼‚äº®äº†ã€‚æ—¨åœ¨è®©å¤§å®¶é€šè¿‡çœŸæ­£çš„ä»£ç å®æˆ˜æ¥å­¦ä¹ å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¦‚æœæƒ³æŠŠç•Œé¢åšå¾—æ›´æ¼‚äº®å¯ä»¥æŠŠä»£ç æ‹‰ä¸‹æ¥ä¹‹ååŠ ä¸Šä¸€äº›æ ·å¼æ¬§ï¼

**ä¸è¿‡æˆ‘è¿˜æ˜¯å»ºè®®å¤§å®¶èƒ½å¤Ÿä½¿ç”¨æ–¹æ³•ä¸€ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œè¿™æ ·å°è±¡ä¼šæ›´åŠ æ·±åˆ»ä¸€ç‚¹ï¼Œèƒ½å¸®åŠ©ä½ æ›´å¿«åœ°å­¦ä¹ å’Œç†è§£æœ¬æ–‡çš„å†…å®¹ï¼**

## åŸºç¡€æ•™ç¨‹

### ç»„ä»¶å¼€å‘

æˆ‘ä»¬å®Œæˆå‡†å¤‡å·¥ä½œåï¼Œå°±å¯ä»¥å¼€å§‹å†™ä»£ç äº†ã€‚

æŒ‰ç…§æƒ¯ä¾‹ï¼Œç¬¬ä¸€æ¬¡è¦æ…¢æ…¢æ¥ï¼Œå…ˆé€‚åº”ä¸€ä¸‹ï¼Œé¿å…ç”¨åŠ›è¿‡çŒ›ï¼š

æˆ‘ä»¬å…ˆå†™ä¸ª HelloWorldï¼Œå¸Œæœ›èƒ½ç»™æˆ‘ä»¬åé¢çš„å­¦ä¹ å¸¦æ¥å¥½è¿ï¼

```ts
// App.tsx
import React, { useState } from 'react';
import './App.css';

function App() {
  const [content, setContent] = useState('Hello World!');

  return (
    <div
      className="app"
      // æ–¹ä¾¿æµ‹è¯•ç”¨ä¾‹ä¸­è·å– DOM èŠ‚ç‚¹
      data-testid="container"
      onClick={() => {
        setContent('Hello Jack!');
      }}
    >
      {content}
    </div>
  );
}

export default App;
```

éå¸¸ç®€å•çš„ç»„ä»¶ï¼Œç‚¹å‡»ä¸€ä¸‹ä¼šå˜æˆ **Hello Jack!**ï¼š

![HelloWorld](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/995ae86408084721af81837f7536bfb1~tplv-k3u1fbpfcp-zoom-1.image)

### æµ‹è¯•ç”¨ä¾‹ç¼–å†™

é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿™ä¸ª HelloWorld çš„ç»„ä»¶ï¼Œæœ‰å“ªäº›åœ°æ–¹éœ€è¦æµ‹è¯•ï¼Ÿ

æˆ‘ä»¬ä¸å¦¨ç«™åœ¨ç”¨æˆ·çš„è§’åº¦æ€è€ƒä¸€ä¸‹ï¼š

1. çœ‹åˆ° **Hello World!**
2. ç‚¹å‡» **Hello World!**
3. çœ‹åˆ° **Hello Jack!**

é‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦è®©è¿™ä¸ªæµç¨‹èµ°é€šï¼Œå°±éœ€è¦é€šè¿‡è¿™å‡ ä¸ªæ­¥éª¤ï¼š

1. HelloWorld ç»„ä»¶æ¸²æŸ“æ­£å¸¸ï¼Œ`div` æ ‡ç­¾çš„å†…å®¹ä¸º **Hello World!**
2. `children` ä¸º **Hello World!** çš„ `div` æ ‡ç­¾è¢«ç‚¹å‡»
3. `div` æ ‡ç­¾çš„ `children` å˜æˆ **Hello Jack!**

ç”»ä¸€ä¸ªæµç¨‹å›¾ï¼š

![HelloWorld](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4c6c93c89bff4995a24ed5163d36e50f~tplv-k3u1fbpfcp-zoom-1.image)

å‘ç°æ²¡æœ‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ€æƒ³æ–¹å¼æ˜¯ **BDD**ï¼Œä¸äº†è§£ **BDD** çš„åŒå­¦ï¼Œå¯ä»¥å›å»ç¿»æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼š[ä¼ é€é—¨](https://juejin.im/post/5eeae4f7e51d4574195ed982)ã€‚

é‚£ä¹ˆï¼Œæ—¢ç„¶æˆ‘ä»¬å·²ç»æ˜ç¡®äº†è¿›è¡Œæµ‹è¯•æ‰€éœ€è¦çš„è¡ŒåŠ¨ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å†™æµ‹è¯•ä»£ç äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `React` å®˜æ–¹é»˜è®¤çš„ [**React Testing Library**](https://github.com/testing-library/react-testing-library)ã€‚

**åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼ŒReact å·²ç»é»˜è®¤ä¸ºæˆ‘ä»¬é…ç½®å¥½äº†ï¼ŒåŸºç¡€æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•ã€‚**

æˆ‘ä»¬åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ä¼šå‘ç°ï¼Œåœ¨ `src` ç›®å½•ä¸‹æœ‰ä¸€ä¸ª `App.test.tsx` çš„æ–‡ä»¶ï¼Œæ‰“å¼€å®ƒæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªéå¸¸ç®€å•çš„æµ‹è¯•ç”¨ä¾‹ï¼š

```ts
// App.test.tsx
import React from 'react';
import { render } from '@testing-library/react';
import App from './App';

test('renders learn react link', () => {
  // render æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…è£¹å¯¹è±¡ å¯¹è±¡ä¸­åŒ…æ‹¬ä¸€äº›å¯¹ DOM çš„æŸ¥è¯¢/è·å–æ–¹æ³•
  // getByText: é€šè¿‡æ ‡ç­¾çš„ text è·å– DOM
  const { getByText } = render(<App />);
  // è·å– text åŒ¹é…æ­£åˆ™ /learn react/i çš„ DOM
  const linkElement = getByText(/learn react/i);
  // åˆ¤æ–­ DOM æ˜¯å¦åœ¨ Document ä¸­
  expect(linkElement).toBeInTheDocument();
});
```

è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ Demoï¼Œå¯èƒ½ä¸æ‡‚çš„åœ°æ–¹ï¼Œæˆ‘éƒ½åœ¨ä»£ç æ³¨é‡Šäº†ï¼Œæ›´å¤šè¯¦ç»†çš„å†…å®¹è¿˜æ˜¯è¦åˆ° [**React Testing Library**](https://github.com/testing-library/react-testing-library) æ–‡æ¡£ä¸­å»è·å–ã€‚

### è¿è¡Œæµ‹è¯•ç”¨ä¾‹

æˆ‘ä»¬å…ˆåœ¨æ§åˆ¶å°æ‰§è¡Œä¸€ä¸‹

```bash
npm run test
```

ä½ ä¼šå‘ç°ç»“æœæ˜¯è¿™æ ·çš„ï¼š

![æŠ¥é”™](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36fcac851d4d42f7aeeb1a87662a3673~tplv-k3u1fbpfcp-zoom-1.image)

è¿™æ˜¯å› ä¸º `getByTextId` è¿™ä¸ª APIï¼Œåœ¨æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ DOM èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚

ç°åœ¨æˆ‘ä»¬æŠŠè¿™éƒ¨åˆ†çš„å†…å®¹åˆ æ‰ï¼Œæ¢æˆæˆ‘ä»¬éœ€è¦ç¼–å†™çš„æµ‹è¯•ç”¨ä¾‹ï¼š

```ts
// App.test.tsx
import React from 'react';
import { render, fireEvent, RenderResult } from '@testing-library/react';
import App from './App';

let wrapper: RenderResult;

// è¿è¡Œæ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å‰å…ˆæ¸²æŸ“ç»„ä»¶
beforeEach(() => {
  wrapper = render(<App />);
});

describe('Should render App component correctly', () => {
  // åˆå§‹åŒ–æ–‡æœ¬å†…å®¹ä¸º "Hello World!"
  test('Should render "Hello World!" correctly', () => {
    // getByTestId: é€šè¿‡å±æ€§ data-testid æ¥è·å–å¯¹åº”çš„  DOM
    // è¿™é‡Œæˆ‘ä»¬è·å–åˆ°çš„æ˜¯ä¸Šé¢ HelloWorld ç»„ä»¶ä¸­çš„ div æ ‡ç­¾
    const app = wrapper.getByTestId('container');
    expect(app).toBeInTheDocument();
    // åˆ¤æ–­è·å–åˆ°çš„æ ‡ç­¾æ˜¯å¦æ˜¯ div
    expect(app.tagName).toEqual('DIV');
    // åˆ¤æ–­ div æ ‡ç­¾çš„ text æ˜¯å¦åŒ¹é…æ­£åˆ™ /world/i
    expect(app.textContent).toMatch(/world/i);
  });

  // ç‚¹å‡»åæ–‡æœ¬å†…å®¹ä¸º "Hello Jack!"
  test('Should render "Hello Jack!" correctly after click', () => {
    const app = wrapper.getByTestId('container');
    // fireEvent: æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶
    fireEvent.click(app);
    expect(app.textContent).toMatch(/jack/i);
  });
});
```

è¿™é‡Œå¯èƒ½æœ‰äº›åŒå­¦å¼€å§‹ä¸çŸ¥æ‰€äº‘äº†ï¼Œæ²¡å…³ç³»ï¼Œä¸€è¡Œä¸€è¡Œæ¥çœ‹æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ã€‚

```ts
let wrapper: RenderResult;

// è¿è¡Œæ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å‰å…ˆæ¸²æŸ“ç»„ä»¶
beforeEach(() => {
  wrapper = render(<App />);
});
```

`beforeEach` ç”Ÿå‘½å‘¨æœŸé’©å­ä¼šåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œä¹‹å‰è¿è¡Œï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°† HelloWorld ç»„ä»¶æ¸²æŸ“åˆ°äº†åœ¨ `node` ä¸Šæ¨¡æ‹Ÿçš„ jsdom ç¯å¢ƒä¸­ï¼Œå…¶å®å°±æ˜¯åœ¨ node ä¸Šæ¨¡æ‹Ÿäº†ä¸€ä¸ªæµè§ˆå™¨ã€‚

æˆ‘ä»¬ç”¨ `wrapper` å˜é‡æ¥ä¿å­˜æˆ‘ä»¬æ¸²æŸ“å‡ºæ¥çš„ç»“æœï¼Œç„¶åå†é€šè¿‡ React Testing Library ä¸ºæˆ‘ä»¬å°è£…çš„ä¸€äº›æ–¹æ³•æ¥è·å–å¯¹åº”çš„ DOM å…ƒç´ ã€‚

```ts
describe('Should render App component correctly', () => {});
```

çœ‹åˆ°è¿™é‡Œå¯èƒ½æœ‰äº›åŒå­¦åˆæ‡µäº†ï¼Œå…¶å®è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å­—é¢æ„æ€ â€”â€” ä¸ºæµ‹è¯•ä¸€ä¸ªå¤§çš„æµ‹è¯•çš„å•å…ƒæ·»åŠ ä¸€ä¸ªæè¿°ã€‚

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸å†™ï¼Œç›´æ¥å†™ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚å¦‚æœä¸å†™çš„è¯ï¼Œ`Jest` ä¼šé»˜è®¤ç”¨æ–‡ä»¶åä½œä¸ºæµ‹è¯•å•å…ƒæè¿°ã€‚

æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹éƒ½å†™åœ¨

```ts
test('æµ‹è¯•ç”¨ä¾‹çš„æè¿°', () => {});
```

çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæ¯ä¸€ä¸ª `test` å‡½æ•°å°±æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚

`test` å‡½æ•°è¿˜æœ‰ä¸€ä¸ªåˆ«å `it`ï¼Œå¤§å®¶åœ¨åé¢å¦‚æœçœ‹åˆ°

```ts
it('æµ‹è¯•ç”¨ä¾‹çš„æè¿°', () => {});
```

ä¹Ÿä¸è¦æƒŠè®¶ï¼ŒçŸ¥é“å®ƒå°±æ˜¯ `test` å°±å¯ä»¥äº†ã€‚

ä¸Šé¢çš„è¿™éƒ¨åˆ†æ•™ç¨‹ï¼Œç®—æ˜¯å¯¹ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ²¡æœ‰è®²åˆ°çš„éƒ¨åˆ†çš„è¡¥å……ï¼Œé¿å…çœ‹æ–‡ç« çš„æœ‹å‹ä»¬ä¸çŸ¥é“è¿™æ ·å†™çš„åŸå› ã€‚

ç°åœ¨æˆ‘ä»¬è¿è¡Œ

```bash
npm run test
```

ç»“æœå°±å˜æˆäº†è¿™æ ·ï¼š

![é€šè¿‡](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/103c56c9e2e54152a902bf3827a482d8~tplv-k3u1fbpfcp-zoom-1.image)

**çœ‹åˆ°ä¸€ä¸²ç‰‡ç»¿æ²¹æ²¹çš„ç»“æœï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Ÿ**

### å†æ¥ä¸€é

ç°åœ¨æˆ‘ä»¬å‡çº§ä¸€ä¸‹ï¼Œä¹Ÿå¸¦å¤§å®¶çœ‹çœ‹ React Testing Library å®˜æ–¹çš„åŸºç¡€ç¤ºä¾‹ï¼š

```js
// hidden-message.js
import React from 'react';

// NOTE: React Testing Library works with React Hooks _and_ classes just as well
// and your tests will be the same however you write your components.
function HiddenMessage({ children }) {
  const [showMessage, setShowMessage] = React.useState(false);
  return (
    <div>
      <label htmlFor="toggle">Show Message</label>
      <input
        id="toggle"
        type="checkbox"
        onChange={(e) => setShowMessage(e.target.checked)}
        checked={showMessage}
      />
      {showMessage ? children : null}
    </div>
  );
}

export default HiddenMessage;
```

```js
// __tests__/hidden-message.js
// these imports are something you'd normally configure Jest to import for you
// automatically. Learn more in the setup docs: https://testing-library.com/docs/react-testing-library/setup#cleanup
import '@testing-library/jest-dom';
// NOTE: jest-dom adds handy assertions to Jest and is recommended, but not required

import React from 'react';
import { render, fireEvent, screen } from '@testing-library/react';
import HiddenMessage from '../hidden-message';

test('shows the children when the checkbox is checked', () => {
  const testMessage = 'Test Message';
  render(<HiddenMessage>{testMessage}</HiddenMessage>);

  // query* functions will return the element or null if it cannot be found
  // get* functions will return the element or throw an error if it cannot be found
  expect(screen.queryByText(testMessage)).toBeNull();

  // the queries can accept a regex to make your selectors more resilient to content tweaks and changes.
  fireEvent.click(screen.getByLabelText(/show/i));

  // .toBeInTheDocument() is an assertion that comes from jest-dom
  // otherwise you could use .toBeDefined()
  expect(screen.getByText(testMessage)).toBeInTheDocument();
});
```

ä¸Šé¢ä¸€å †è‹±æ–‡æ³¨é‡Šï¼Œè‚¯å®šæœ‰è‹±è¯­ä¸å¥½çš„æœ‹å‹ä¼šè¯´ï¼š**â€œå•Šä½ è¿™ç…§æ¬ç…§å¥—å…¨æ˜¯è‹±æ–‡çš„æˆ‘æ€ä¹ˆçœ‹å¾—æ‡‚å•Š~â€**

åˆ«æ€¥ï¼Œæˆ‘ç»™ä½ ç¿»è¯‘ä¸€ä¸‹ï¼

```ts
// query* functions will return the element or null if it cannot be found
// get* functions will return the element or throw an error if it cannot be found
expect(screen.queryByText(testMessage)).toBeNull();
```

è¿™ä¸€æ®µä»£ç ï¼Œä½¿ç”¨äº†ä¸€ä¸ª APIï¼š`queryByText`ï¼Œè¿™ä¸ª API çš„ä½œç”¨æ˜¯ï¼Œé€šè¿‡ `text` æ¥æŸ¥æ‰¾å¯¹åº”çš„ DOMã€‚å¯æ˜¯ï¼Œ`queryByText` å’Œ `getByText` åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

åŒºåˆ«å°±åœ¨äº `query*` ç±»å‹çš„ API åœ¨è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ DOMï¼Œä¼šè¿”å› `null`ï¼Œä½†æ˜¯ `get*` åœ¨æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ DOM æ—¶ä¼šç›´æ¥æŠ¥é”™ã€‚

```ts
// the queries can accept a regex to make your selectors more resilient to content tweaks and changes.
fireEvent.click(screen.getByLabelText(/show/i));
```

è¿™ä¸€æ®µä»£ç ï¼Œç»è¿‡ä¸Šé¢æˆ‘çš„è®²è§£åº”è¯¥ä¸é™Œç”Ÿäº†ï¼Œæ¨¡æ‹Ÿä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ã€‚æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ä¹‹å‰æˆ‘ä»¬å¾—å…ˆæ‰¾åˆ°å¯¹åº”çš„ DOMï¼Œ`getByLabelText` API å°±æ˜¯é€šè¿‡ `label` çš„å†…å®¹æ‰¾åˆ°å¯¹åº”çš„ DOMï¼Œä¼ é€’çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚

```ts
// .toBeInTheDocument() is an assertion that comes from jest-dom
// otherwise you could use .toBeDefined()
expect(screen.getByText(testMessage)).toBeInTheDocument();
```

è¿™ä¸€æ®µä»£ç ç”¨äºåˆ¤æ–­ DOM æ˜¯å¦åœ¨ `Document` ä¸­ï¼Œå…¶ä¸­ `toBeInTheDocument` API æ˜¯ `jest-dom` æä¾›çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¿…é¡»çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `jest` è‡ªå¸¦çš„ API `toBeDefined` æ¥åˆ¤æ–­ã€‚

**å®æˆ˜çš„åŸºç¡€éƒ¨åˆ†å°±è¿™ä¹ˆå¤šï¼Œæƒ³çœ‹è¿›é˜¶éƒ¨åˆ†çš„åŒå­¦å¯ä»¥å¾€ä¸‹ç»§ç»­å­¦ä¹ è§‚çœ‹~**

## è¿›é˜¶æ•™ç¨‹

### å¼¹å‡ºå·¥ç¨‹é…ç½®

å‡†å¤‡å·¥ä½œä¸­**æ–¹æ³•ä¸€**çš„ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºäº TypeScript çš„ `React` é¡¹ç›®ã€‚ä½¿ç”¨ `create-react-app` è„šæ‰‹æ¶åˆ›å»ºçš„é¡¹ç›®ä¸­å·²ç»é»˜è®¤å¼•å…¥äº†è‡ªåŠ¨åŒ–æµ‹è¯•çš„å·¥å…·ï¼Œä½†æ˜¯è„šæ‰‹æ¶é»˜è®¤å°†å·¥å…·çš„ä¸€äº›é…ç½®éšè—èµ·æ¥äº†ï¼Œæˆ‘ä»¬å¦‚æœå¸Œæœ›å°†é…ç½®å¼¹å‡ºå¹¶è¿›è¡Œæ‰‹åŠ¨é…ç½®ï¼Œå°±éœ€è¦è¿è¡Œï¼š

```bash
npm run eject
```

å°†é»˜è®¤çš„ä¸€äº›å·¥ç¨‹åŒ–é…ç½®å¼¹å‡ºï¼Œå¼¹å‡ºåé¡¹ç›®çš„ç›®å½•ä¼šå˜æˆè¿™æ ·ï¼š

```bash
README.md         node_modules      package.json      scripts
config            package-lock.json public            src
```

ä¼šæ¯”é¡¹ç›®åˆšåˆ›å»ºçš„æ—¶å€™å¤šäº† `config` å’Œ `scripts` ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯ä¸€äº›è„šæ‰‹æ¶é»˜è®¤çš„å·¥ç¨‹é…ç½®æ–‡ä»¶ï¼Œå¦‚æœå¯¹å·¥ç¨‹åŒ–ä¸æ˜¯éå¸¸äº†è§£ï¼Œ**åƒä¸‡åˆ«ä¹±æ”¹**ï¼

é™¤äº†å¤šäº†ä¸¤ä¸ªæ–‡ä»¶ç›®å½•ä¹‹å¤–ï¼Œåœ¨ `package.json` ä¸­ä¹Ÿæ·»åŠ äº†å¾ˆå¤šä¾èµ–ï¼ŒåŒæ—¶è¿˜æ·»åŠ äº† `babel` å’Œ `jest` çš„é…ç½®ï¼š

```json
  "jest": {
    "roots": [
      "<rootDir>/src"
    ],
    "collectCoverageFrom": [
      "src/**/*.{js,jsx,ts,tsx}",
      "!src/**/*.d.ts"
    ],
    "setupFiles": [
      "react-app-polyfill/jsdom"
    ],
    "setupFilesAfterEnv": [
      "<rootDir>/src/setupTests.js"
    ],
    "testMatch": [
      "<rootDir>/src/**/__tests__/**/*.{js,jsx,ts,tsx}",
      "<rootDir>/src/**/*.{spec,test}.{js,jsx,ts,tsx}"
    ],
    "testEnvironment": "jest-environment-jsdom-fourteen",
    "transform": {
      "^.+\\.(js|jsx|ts|tsx)$": "<rootDir>/node_modules/babel-jest",
      "^.+\\.css$": "<rootDir>/config/jest/cssTransform.js",
      "^(?!.*\\.(js|jsx|ts|tsx|css|json)$)": "<rootDir>/config/jest/fileTransform.js"
    },
    "transformIgnorePatterns": [
      "[/\\\\]node_modules[/\\\\].+\\.(js|jsx|ts|tsx)$",
      "^.+\\.module\\.(css|sass|scss)$"
    ],
    "modulePaths": [],
    "moduleNameMapper": {
      "^react-native$": "react-native-web",
      "^.+\\.module\\.(css|sass|scss)$": "identity-obj-proxy"
    },
    "moduleFileExtensions": [
      "web.js",
      "js",
      "web.ts",
      "ts",
      "web.tsx",
      "tsx",
      "json",
      "web.jsx",
      "jsx",
      "node"
    ],
    "watchPlugins": [
      "jest-watch-typeahead/filename",
      "jest-watch-typeahead/testname"
    ]
  },
  "babel": {
    "presets": [
      "react-app"
    ]
  }
```

è¿™äº›éƒ½æ˜¯ `React` å®˜æ–¹æä¾›çš„ `babel` å’Œ `jest` çš„é»˜è®¤é…ç½®ï¼Œå¦‚æœè¿˜æ²¡ææ‡‚ `babel` å’Œ `jest`ï¼Œ**ä¸è¦éšæ„ä¿®æ”¹æ¬§**ï¼

### è¿ç§» Jest/Babel é…ç½®

é…ç½®éƒ½æ”¾åœ¨ `package.json` ä¸­ä¸æ˜¯å¾ˆæ–¹ä¾¿æ“ä½œï¼Œå¦‚æœè¦ä¿®æ”¹æ¯æ¬¡éƒ½è¦åˆ° `package.json` ä¸­å»æ‰¾ï¼Œæˆ‘ä»¬æŠŠä»–ä»¬å•ç‹¬æŠ½å‡ºæ¥ï¼š

é¦–å…ˆåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ `babel.config.js` `jest.config.js`ï¼Œç„¶ååˆ†åˆ«å°† `package.json` ä¸­çš„ Babel é…ç½®å’Œ Jest é…ç½®å¤åˆ¶åˆ°å¯¹åº”çš„ config æ–‡ä»¶ä¸­ï¼š

```js
// jest.config.js

module.exports = {
  roots: ['<rootDir>/src'],
  collectCoverageFrom: ['src/**/*.{js,jsx,ts,tsx}', '!src/**/*.d.ts'],
  setupFiles: ['react-app-polyfill/jsdom'],
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  testMatch: [
    '<rootDir>/src/**/__tests__/**/*.{js,jsx,ts,tsx}',
    '<rootDir>/src/**/*.{spec,test}.{js,jsx,ts,tsx}'
  ],
  testEnvironment: 'jest-environment-jsdom-fourteen',
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': '<rootDir>/node_modules/babel-jest',
    '^.+\\.css$': '<rootDir>/config/jest/cssTransform.js',
    '^(?!.*\\.(js|jsx|ts|tsx|css|json)$)':
      '<rootDir>/config/jest/fileTransform.js'
  },
  transformIgnorePatterns: [
    '[/\\\\]node_modules[/\\\\].+\\.(js|jsx|ts|tsx)$',
    '^.+\\.module\\.(css|sass|scss)$'
  ],
  modulePaths: [],
  moduleNameMapper: {
    '^react-native$': 'react-native-web',
    '^.+\\.module\\.(css|sass|scss)$': 'identity-obj-proxy'
  },
  moduleFileExtensions: [
    'web.js',
    'js',
    'web.ts',
    'ts',
    'web.tsx',
    'tsx',
    'json',
    'web.jsx',
    'jsx',
    'node'
  ],
  watchPlugins: [
    'jest-watch-typeahead/filename',
    'jest-watch-typeahead/testname'
  ]
};
```

```js
// babel.config.js
module.exports = {
  presets: ['react-app']
};
```

### Jest é…ç½®è¯¦è§£

æˆ‘çŒœï¼Œè¿™é‡Œè‚¯å®šåˆæœ‰åŒå­¦è¯´ï¼š**â€œå•Šä½ è¿™ä¸ªä¹±ä¸ƒå…«ç³Ÿä¸€å¤§å †é…ç½®æˆ‘æ€ä¹ˆçœ‹å¾—æ‡‚å•Š~â€**

åˆ«æ€¥ï¼Œè®©æˆ‘ä»¬é€æ¡æ¥çœ‹ï¼

`babel.config.js` çš„å†…å®¹å¤ªç®€å•ï¼Œå°±ä¸è¯¦ç»†è®²è§£äº†ï¼Œæˆ‘ä»¬ä¸»è¦æ¥è®²ä¸€è®² `jest.config.js`ï¼š

```js
roots: ['<rootDir>/src'],
```

`roots` æ˜¯ç”¨äºæŒ‡å®š Jest çš„æ ¹ç›®å½•çš„ï¼ŒJest åªä¼šæ£€æµ‹åœ¨æ ¹ç›®å½•ä¸‹çš„æµ‹è¯•ç”¨ä¾‹å¹¶è¿è¡Œã€‚

```js
collectCoverageFrom: ['src/**/*.{js,jsx,ts,tsx}', '!src/**/*.d.ts'],
```

`src` ç›®å½•ä¸‹æ–‡ä»¶å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘ä»¬è¦ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼Œä¸€äº›æ— å…³çš„æ–‡ä»¶å°±ä¸èƒ½è¢«ç»Ÿè®¡åˆ°è¦†ç›–ç‡å½“ä¸­ã€‚

`collectCoverageFrom` æ˜¯ç”¨äºæŒ‡å®šæµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡èŒƒå›´çš„ï¼š`src` ä¸‹çš„æ‰€æœ‰ `js,jsx,ts,tsx` æ–‡ä»¶ï¼ŒåŒæ—¶æ’é™¤ `.d.ts` ç±»å‹å£°æ˜æ–‡ä»¶ã€‚

```js
setupFiles: ['react-app-polyfill/jsdom'],
```

`setupFiles` æ˜¯ç”¨äºæŒ‡å®šåˆ›å»ºæµ‹è¯•ç¯å¢ƒå‰çš„å‡†å¤‡æ–‡ä»¶çš„ï¼Œè¿™é‡Œå¼•å…¥ `react-app-polyfill/jsdom` è§£å†³ `jsdom` çš„å…¼å®¹æ€§é—®é¢˜ã€‚

```js
setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
```

`setupFilesAfterEnv` æ˜¯ç”¨äºæŒ‡å®šæµ‹è¯•ç¯å¢ƒåˆ›å»ºå®Œæˆåä¸ºæ¯ä¸ªæµ‹è¯•æ–‡ä»¶ç¼–å†™çš„é…ç½®æ–‡ä»¶ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é»˜è®¤çš„ `setupTests.ts` ä¸­å†…å®¹æ˜¯è¿™æ ·çš„ï¼š

```ts
// jest-dom adds custom jest matchers for asserting on DOM nodes.
// allows you to do things like:
// expect(element).toHaveTextContent(/react/i)
// learn more: https://github.com/testing-library/jest-dom
import '@testing-library/jest-dom/extend-expect';
```

åœ¨æµ‹è¯•ç¯å¢ƒåˆ›å»ºå®Œæˆåä¸ºæ¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶éƒ½å¼•å…¥ `@testing-library/jest-dom/extend-expect`ï¼Œä¸º Jest æä¾›äº†æ›´å¤šé€‚é… `React` çš„åŒ¹é…å™¨ï¼Œå¦‚ `toHaveTextContent`ã€‚

```js
testMatch: [
    '<rootDir>/src/**/__tests__/**/*.{js,jsx,ts,tsx}',
    '<rootDir>/src/**/*.{spec,test}.{js,jsx,ts,tsx}'
  ],
```

`testMatch` æ˜¯ç”¨äºé…ç½® Jest åŒ¹é…æµ‹è¯•æ–‡ä»¶çš„è§„åˆ™çš„ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°é…ç½®é¡¹ä¸­å¡«å†™çš„æ˜¯åœ¨ `__tests__` æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ `js,jsx,ts,tsx` ä»¥åŠä»¥ `.spec/.test` ç»“å°¾çš„ `js,jsx,ts,tsx` æ–‡ä»¶ã€‚

```js
testEnvironment: 'jest-environment-jsdom-fourteen',
```

`testEnvironment` åº”è¯¥èƒ½è§åçŸ¥ä¹‰äº†ï¼Œå°±æ˜¯ç”¨äºæŒ‡å®šæµ‹è¯•ç”¨ä¾‹è¿åŠ¨çš„ç¯å¢ƒçš„ã€‚

æˆ‘ä»¬çŸ¥é“ Jest æ˜¯è¿è¡Œåœ¨ node ç¯å¢ƒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å‰ç«¯ä»£ç å´æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€äº›æ–¹æ³•åœ¨ node ç¯å¢ƒä¸‹æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒã€‚

è¿™é‡Œ `React` å®˜æ–¹æ¨èçš„æ˜¯ä½¿ç”¨ `jest-environment-jsdom-fourteen`ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»æœç´¢ä¸€ä¸‹è¿™ä¸ªåº“ï¼Œç°åœ¨å·²ç»æœ‰äº† `sixteen` ç‰ˆæœ¬äº†ã€‚

```js
transform: {
    '^.+\\.(js|jsx|ts|tsx)$': '<rootDir>/node_modules/babel-jest',
    '^.+\\.css$': '<rootDir>/config/jest/cssTransform.js',
    '^(?!.*\\.(js|jsx|ts|tsx|css|json)$)':
      '<rootDir>/config/jest/fileTransform.js'
  },
```

`transform` æ˜¯ç”¨äºé…ç½®æ–‡ä»¶å¤„ç†æ¨¡å—çš„ã€‚

æˆ‘ä»¬åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®æ˜¯éœ€è¦å»æ‰ CSS å’Œå…¶ä»–ä¸ç»„ä»¶é€»è¾‘ç›¸å…³æ€§ä¸å¤§çš„é™æ€èµ„æºçš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ç»„ä»¶ä»£ç ä¸­æœ‰æ—¶å€™åˆéœ€è¦å¼•å…¥è¿™äº›ä»£ç ã€‚

é‚£ä¹ˆåœ¨æˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™ï¼Œå°±éœ€è¦æŒ‡å®šä¸€äº›æ¨¡å—æ¥å¤„ç†/ä»£æ›¿è¿™äº›æ–‡ä»¶ï¼Œä¸ç„¶å°±å¯èƒ½ä»¥ä¸ºæ‰¾ä¸åˆ°æ¨¡å—çš„é—®é¢˜æŠ¥é”™ã€‚

è¿™éƒ¨åˆ†çš„ä»£ç å°±æ˜¯æŒ‡å®šäº†æ‰€æœ‰çš„ `js,jsx,ts,tsx` ä½¿ç”¨ `babel-jest` çš„æ’ä»¶åšå¤„ç†ï¼Œæ‰€æœ‰çš„ `css` æ–‡ä»¶ä½¿ç”¨ `<rootDir>/config/jest/cssTransform.js` æ¨¡å—åšå¤„ç†ï¼Œæ‰€æœ‰çš„é `js,jsx,ts,tsx,css,json` æ–‡ä»¶ï¼Œéƒ½ä½¿ç”¨ `<rootDir>/config/jest/fileTransform.js` æ¨¡å—åšå¤„ç†ã€‚

é‚£æ—¢ç„¶ç”¨åˆ°äº†è¿™ä¸¤ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å°±åˆ°æ¨¡å—çœ‹çœ‹ `React` å®˜æ–¹çš„é…ç½®æ˜¯ä»€ä¹ˆæ ·çš„ï¼š

```js
// cssTransform.js
'use strict';

module.exports = {
  process() {
    return 'module.exports = {};';
  },
  getCacheKey() {
    // The output is always the same.
    return 'cssTransform';
  }
};
```

`cssTransform.js` æ¨¡å—ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é»˜è®¤ä½¿ç”¨äº†ä¸€ä¸ªç©ºçš„æ¨¡å—ä»£æ›¿ `css` æ–‡ä»¶ã€‚

```js
// fileTransform.js
'use strict';

const path = require('path');
const camelcase = require('camelcase');

// This is a custom Jest transformer turning file imports into filenames.
// http://facebook.github.io/jest/docs/en/webpack.html

module.exports = {
  process(src, filename) {
    const assetFilename = JSON.stringify(path.basename(filename));

    if (filename.match(/\.svg$/)) {
      // Based on how SVGR generates a component name:
      // https://github.com/smooth-code/svgr/blob/01b194cf967347d43d4cbe6b434404731b87cf27/packages/core/src/state.js#L6
      const pascalCaseFilename = camelcase(path.parse(filename).name, {
        pascalCase: true
      });
      const componentName = `Svg${pascalCaseFilename}`;
      return `const React = require('react');
      module.exports = {
        __esModule: true,
        default: ${assetFilename},
        ReactComponent: React.forwardRef(function ${componentName}(props, ref) {
          return {
            $$typeof: Symbol.for('react.element'),
            type: 'svg',
            ref: ref,
            key: null,
            props: Object.assign({}, props, {
              children: ${assetFilename}
            })
          };
        }),
      };`;
    }

    return `module.exports = ${assetFilename};`;
  }
};
```

`fileTransform.js` æ¨¡å—ä¸­å¯ä»¥çœ‹åˆ°é»˜è®¤çš„é…ç½®æ˜¯å½“æ–‡ä»¶åæ˜¯ä»¥ `.svg` ç»“å°¾æ—¶ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª `React` çš„ SVG ç»„ä»¶å¹¶è¿”å›ï¼Œå¦åˆ™ç›´æ¥è¿”å›æ–‡ä»¶åã€‚

```js
transformIgnorePatterns: [
    '[/\\\\]node_modules[/\\\\].+\\.(js|jsx|ts|tsx)$',
    '^.+\\.module\\.(css|sass|scss)$'
  ],
```

`transformIgnorePatterns` ç”¨äºé…ç½®æ–‡ä»¶å¤„ç†æ¨¡å—åº”è¯¥å¿½ç•¥çš„æ–‡ä»¶ï¼ŒReact å®˜æ–¹çš„é…ç½®æ˜¯å¿½ç•¥ `node_modules` æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ `js,jsx,ts,tsx`ï¼Œå¿½ç•¥æ‰€æœ‰çš„ CSS Module æ–‡ä»¶ã€‚

```js
modulePaths: [],
```

`modulePaths` ç”¨äºæŒ‡å®šæ¨¡å—çš„æŸ¥æ‰¾è·¯å¾„ï¼Œé»˜è®¤ä¼šåœ¨ `node_modules` ä¸‹æŸ¥æ‰¾ï¼Œå¦‚æœéœ€è¦åœ¨å…¶ä»–çš„æ–‡ä»¶è·¯å¾„ä¸‹æŸ¥æ‰¾æ¨¡å—ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶è·¯å¾„ã€‚

```js
moduleNameMapper: {
    '^react-native$': 'react-native-web',
    '^.+\\.module\\.(css|sass|scss)$': 'identity-obj-proxy'
  },
```

`moduleNameMapper` ç”¨äºå¯¹æ¨¡å—æ˜ å°„å¤„ç†ã€‚`'^react-native$': 'react-native-web'` æ˜¯å¯¹ React Native åšé…ç½®çš„ï¼ŒWeb åº”ç”¨å¯ä»¥åˆ é™¤ï¼Œ`'^.+\\.module\\.(css|sass|scss)$': 'identity-obj-proxy'` æ˜¯å¯¹ CSS Module åšæ˜ å°„ï¼Œå°† CSS Module è½¬æ¢æˆé”®å€¼å¯¹çš„å½¢å¼ã€‚

```js
moduleFileExtensions: [
    'web.js',
    'js',
    'web.ts',
    'ts',
    'web.tsx',
    'tsx',
    'json',
    'web.jsx',
    'jsx',
    'node'
  ],
```

`moduleFileExtensions` ç”¨äºé…ç½®éœ€è¦æŸ¥æ‰¾çš„æ–‡ä»¶åç¼€åï¼Œå¦‚æœæ˜¯ `React` çš„å•é¡µ Web åº”ç”¨ï¼Œå¯ä»¥åˆ æ‰å…¶ä¸­é `js,jsx,ts,tsx` çš„åç¼€åã€‚

```js
watchPlugins: [
  'jest-watch-typeahead/filename',
  'jest-watch-typeahead/testname'
  ],
```

`watchPlugins` ç”¨äºæŒ‡å®š Jest åœ¨ `watch` æ¨¡å¼ä¸‹çš„æ’ä»¶ï¼Œè¿™éƒ¨åˆ†çš„é…ç½®æˆ‘ä»¬å°±ç”¨ `React` å®˜æ–¹æ¨èçš„å°±è¡Œï¼ŒåŸºæœ¬ä¸éœ€è¦æˆ‘ä»¬æ”¹åŠ¨ã€‚

### æ›´å¤šé…ç½®

å…¶å® Jest æœ‰å¾ˆå¤šéå¸¸å®ç”¨çš„é…ç½®é¡¹ï¼Œå¦‚æœä½ åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œä¸å¦¨å°è¯•ä¸€ä¸‹é˜…è¯»å®˜æ–¹çš„æ–‡æ¡£ï¼š[Jest å®˜æ–¹æ–‡æ¡£](https://jestjs.io/docs/zh-Hans/getting-started)ã€‚

### å¼€å§‹åŠ¨æ‰‹

åœ¨å†™è¿™ä¸ª Demo ä¹‹å‰æƒ³äº†ä¸€ä¸‹ï¼Œè¦æ˜¯åšå¾—å¤ªä¸‘äº†ä¼°è®¡æ²¡äººçˆ±çœ‹ï¼Œäºæ˜¯å†³å®šåšå¥½çœ‹ç‚¹ï¼Œå¯æ˜¯æˆ‘å®¡ç¾åˆä¸æ˜¯å¾ˆåˆ°ä½ï¼Œæƒ³äº†æƒ³æœ€ç»ˆå†³å®šæŠŠ Dell è€å¸ˆçš„ `TODO List` ä¸­çš„æ ·å¼æ¬è¿‡æ¥ï¼Œ**é€»è¾‘å’Œæµ‹è¯•ä»£ç è‡ªå·±å†™**ï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šå°±å¥½å¤šäº†ã€‚

å…ˆæ¥çœ‹ä¸‹æ•ˆæœï¼š

![TODO List](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cbaf078740644c1a09b09c66a692c47~tplv-k3u1fbpfcp-zoom-1.image)

ç»„ä»¶ä»£ç æˆ‘å°±ä¸è¯¦ç»†è®²è§£äº†ï¼Œå¦‚æœæƒ³çœ‹ç»„ä»¶ä»£ç çš„è¯å¯ä»¥åˆ° GitHub ä»“åº“ `clone` ä¸‹æ¥ï¼Œç„¶ååˆ‡æ¢åˆ° `advance/testing-library` åˆ†æ”¯ã€‚

**æˆ‘ä»¬é‡ç‚¹å°±è®²è§£ä¸€ä¸‹å¦‚ä½•å†™æµ‹è¯•çš„éƒ¨åˆ†ï¼**

#### å•å…ƒæµ‹è¯•ï¼ˆTesting-Libraryï¼‰

é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ†æå„ä¸ªç»„ä»¶éœ€è¦æµ‹è¯•ä»€ä¹ˆåŠŸèƒ½ï¼Œ**è¿™ä¸€ç‚¹éå¸¸é‡è¦**ã€‚

**å¦‚æœä¸€å¼€å§‹æ²¡æœ‰æ˜ç¡®å„ä¸ªç»„ä»¶éœ€è¦æµ‹è¯•çš„åŠŸèƒ½ï¼Œå¾ˆæœ‰å¯èƒ½è¿‡åº¦æµ‹è¯•æˆ–è€…é—æ¼æµ‹è¯•åˆ†æ”¯ï¼**

- Header ç»„ä»¶

  1. `input` å­˜åœ¨ä¸” `value` ä¸ºç©º
  2. `input` èƒ½è¾“å…¥
  3. `input` èƒ½å›è½¦æäº¤
  4. `input` èƒ½åœ¨æäº¤åå°† `value` ç½®ç©º

- List ç»„ä»¶
  1. åˆ—è¡¨ä¸ºç©ºï¼Œæ— åˆ—è¡¨é¡¹ï¼Œå³ä¸Šè§’è®¡æ•°å™¨å­˜åœ¨ä¸”å€¼ä¸º 0
  2. åˆ—è¡¨ä¸ä¸ºç©ºï¼Œå­˜åœ¨åˆ—è¡¨é¡¹ï¼Œå³ä¸Šè§’è®¡æ•°å™¨å­˜åœ¨ä¸”ä¸ºåˆ—è¡¨é•¿åº¦ï¼Œåˆ—è¡¨é¡¹åˆ é™¤æŒ‰é’®å­˜åœ¨ï¼Œåˆ—è¡¨é¡¹å¯åˆ é™¤
  3. åˆ—è¡¨ä¸ä¸ºç©ºï¼Œå­˜åœ¨åˆ—è¡¨é¡¹ï¼Œå³ä¸Šè§’è®¡æ•°å™¨å­˜åœ¨ä¸”ä¸ºåˆ—è¡¨é•¿åº¦ï¼Œåˆ—è¡¨é¡¹å†…å®¹ç‚¹å‡»åå˜æˆ `input`ï¼Œå›è½¦åå¯ä¿®æ”¹å¯¹åº”åˆ—è¡¨é¡¹å†…å®¹

æ˜ç¡®äº†æˆ‘ä»¬éœ€è¦æµ‹è¯•çš„åŠŸèƒ½ï¼Œå°±å¯ä»¥å¼€å§‹å†™å•å…ƒæµ‹è¯•çš„ä»£ç äº†ï¼Œæµ‹è¯•ä¸€ä¸‹å„ä¸ªç»„ä»¶æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼š

```ts
// Header.test.tsx
import React from 'react';
import { render, fireEvent, RenderResult } from '@testing-library/react';
import Header from '../../components/Header';

let wrapper: RenderResult;
let input: HTMLInputElement;
const addUndoItem = jest.fn();

beforeEach(() => {
  wrapper = render(<Header addUndoItem={addUndoItem} />);
  input = wrapper.getByTestId('header-input') as HTMLInputElement;
});

afterEach(() => {
  wrapper = null;
  input = null;
});

describe('Header ç»„ä»¶', () => {
  it('ç»„ä»¶åˆå§‹åŒ–æ­£å¸¸', () => {
    // input å­˜åœ¨
    expect(input).not.toBeNull();

    // ç»„ä»¶åˆå§‹åŒ– input value ä¸ºç©º
    expect(input.value).toEqual('');
  });

  it('è¾“å…¥æ¡†åº”è¯¥èƒ½è¾“å…¥', () => {
    const inputEvent = {
      target: {
        value: 'Learn Jest'
      }
    };
    // æ¨¡æ‹Ÿè¾“å…¥
    // è¾“å…¥å input value ä¸ºè¾“å…¥å€¼
    fireEvent.change(input, inputEvent);
    expect(input.value).toEqual(inputEvent.target.value);
  });

  it('è¾“å…¥æ¡†å›è½¦ååº”è¯¥èƒ½æäº¤å¹¶æ¸…ç©º', () => {
    const inputEvent = {
      target: {
        value: 'Learn Jest'
      }
    };
    const keyboardEvent = {
      keyCode: 13
    };
    // æ¨¡æ‹Ÿå›è½¦
    // è°ƒç”¨ addUndoItem props è°ƒç”¨æ—¶å‚æ•°ä¸º input value
    // input value ç½®ç©º
    fireEvent.change(input, inputEvent);
    fireEvent.keyUp(input, keyboardEvent);
    expect(addUndoItem).toHaveBeenCalled();
    expect(addUndoItem).toHaveBeenCalledWith(inputEvent.target.value);
    expect(input.value).toEqual('');
  });
});
```

```ts
// List.test.tsx
import React from 'react';
import { render, fireEvent } from '@testing-library/react';
import List, { IList } from '../../components/List';

describe('List ç»„ä»¶', () => {
  it('ç»„ä»¶åˆå§‹åŒ–æ­£å¸¸', () => {
    const props: IList = {
      list: [],
      deleteItem: jest.fn(),
      changeStatus: jest.fn(),
      handleBlur: jest.fn(),
      valueChange: jest.fn()
    };

    const wrapper = render(<List {...props} />);
    const count = wrapper.queryByTestId('count');
    // è®¡æ•°å™¨å­˜åœ¨ä¸”æ•°å€¼ä¸º 0
    expect(count).not.toBeNull();
    expect(count.textContent).toEqual('0');

    const list = wrapper.queryAllByTestId('list-item');
    // åˆ—è¡¨é¡¹ä¸ºç©º
    expect(list).toHaveLength(0);
  });

  it('åˆ—è¡¨é¡¹åº”è¯¥èƒ½åˆ é™¤', () => {
    const props: IList = {
      list: [{ status: 'div', value: 'Learn Jest' }],
      deleteItem: jest.fn(),
      changeStatus: jest.fn(),
      handleBlur: jest.fn(),
      valueChange: jest.fn()
    };

    const wrapper = render(<List {...props} />);
    const count = wrapper.queryByTestId('count');
    // è®¡æ•°å™¨å­˜åœ¨ä¸”æ•°å€¼ä¸º 1
    expect(count).not.toBeNull();
    expect(count.textContent).toEqual('1');

    const list = wrapper.queryAllByTestId('list-item');
    // åˆ—è¡¨é¡¹ä¸ä¸ºç©º
    expect(list).toHaveLength(1);

    const deleteBtn = wrapper.queryAllByTestId('delete-item');
    // åˆ é™¤æŒ‰é’®ä¸ä¸ºç©º
    expect(deleteBtn).toHaveLength(1);
    const e: Partial<React.MouseEvent> = {};
    fireEvent.click(deleteBtn[0], e);
    // é˜»æ­¢äº‹ä»¶å†’æ³¡
    expect(props.changeStatus).not.toHaveBeenCalled();
    // deleteItem è¢«è°ƒç”¨ å‚æ•°ä¸º 0
    expect(props.deleteItem).toHaveBeenCalled();
    expect(props.deleteItem).toHaveBeenCalledWith(0);
  });

  it('åˆ—è¡¨é¡¹åº”è¯¥èƒ½ç¼–è¾‘', () => {
    const props: IList = {
      list: [
        { status: 'div', value: 'Learn Jest' },
        { status: 'input', value: 'Learn Enzyme' }
      ],
      deleteItem: jest.fn(),
      changeStatus: jest.fn(),
      handleBlur: jest.fn(),
      valueChange: jest.fn()
    };

    const wrapper = render(<List {...props} />);
    const list = wrapper.queryAllByTestId('list-item');
    // ç¬¬ä¸€é¡¹æœªå¤„äºç¼–è¾‘çŠ¶æ€ ç¬¬äºŒé¡¹å¤„äºç¼–è¾‘çŠ¶æ€
    expect(list[0].querySelector('[data-testid="input"]')).toBeNull();
    expect(list[1].querySelector('[data-testid="input"]')).not.toBeNull();

    // ç‚¹å‡»ç¬¬ä¸€é¡¹
    fireEvent.click(list[0]);
    // changeStatus è¢«è°ƒç”¨ å‚æ•°ä¸º 0
    expect(props.changeStatus).toHaveBeenCalled();
    expect(props.changeStatus).toHaveBeenCalledWith(0);

    // ç¬¬äºŒé¡¹ input è¾“å…¥
    fireEvent.change(list[1].querySelector('[data-testid="input"]'), {
      target: { value: 'Learn Testing Library' }
    });
    // valueChange è¢«è°ƒç”¨ å‚æ•°ä¸º 1 Learn Enzyme
    expect(props.valueChange).toHaveBeenCalled();
    expect(props.valueChange).toHaveBeenCalledWith(1, 'Learn Testing Library');

    // ç¬¬äºŒé¡¹ input æ¡†å¤±ç„¦
    fireEvent.blur(list[1].querySelector('[data-testid="input"]'));
    // handleBlur è¢«è°ƒç”¨ å‚æ•°ä¸º 1
    expect(props.handleBlur).toHaveBeenCalled();
    expect(props.handleBlur).toHaveBeenCalledWith(1);
  });
});
```

å•å…ƒæµ‹è¯•éƒ¨åˆ†çš„ä»£ç åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æœ‰ä»‹ç»åˆ°çš„ä¸€äº›åŒ¹é…å™¨ï¼Œæ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æˆ–è€…çœ‹äº†è¿˜æ˜¯ä¸€å¤´é›¾æ°´çš„åŒå­¦å¯ä»¥å›å»å¤ä¹ ä¸€ä¸‹ï¼š[ã€Šè¯•è¯•å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ï¼ˆåŸºç¡€ç¯‡ï¼‰ã€‹](https://juejin.im/post/5eeae4f7e51d4574195ed982)ï¼Œè¿™éƒ¨åˆ†å°±ä¸è¯¦ç»†è®²è§£äº†ã€‚

#### é›†æˆæµ‹è¯•ï¼ˆTesting-Libraryï¼‰

å¯èƒ½æœ‰åŒå­¦ä¼šè¯´ï¼š**â€œä½ ä¸Šé¢è¿™ä¸ªå†…å®¹æµ‹è¯•äº†å•ç‹¬çš„ç»„ä»¶èƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œä¸‡ä¸€ä»–ç»„åˆèµ·æ¥å·¥ä½œä¸æ­£å¸¸å‘¢ï¼Ÿâ€**

å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œä¹Ÿæœ‰è¿™ç§æ„Ÿè§‰çš„è¯ï¼Œå°±è¯´æ˜ä½ å·²ç»æ¯”è¾ƒç†è§£è‡ªåŠ¨åŒ–æµ‹è¯•äº†ã€‚

å•å…ƒæµ‹è¯•æœ‰ä¸€ä¸ªé»˜è®¤çš„å‰æï¼š**å¦‚æœä¸€ä»½ä»£ç çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆè¿™ä»½ä»£ç å°±èƒ½æ­£å¸¸å·¥ä½œã€‚**

å°±å¥½åƒä¸€ä¸ªé½¿è½®ç»„ï¼Œå¦‚æœé½¿è½®ç»„ä¸­çš„æ‰€æœ‰é½¿è½®éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆæ•´ä¸ªé½¿è½®ç»„å°±èƒ½æ­£å¸¸å·¥ä½œã€‚

**æ­£å¸¸æ¥è®²ï¼Œåœ¨ä¼ä¸šå¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå®ç°è¾ƒé«˜çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦å†å»å†™é›†æˆæµ‹è¯•çš„ä»£ç ï¼Œæ¥æ£€æµ‹ç»„åˆåçš„ä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œã€‚**

ä½†æ˜¯å‘¢ï¼Œè¿™é‡Œåˆæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ

æœ‰æ²¡æœ‰å‘ç°ä¸Šé¢çš„æµ‹è¯•ä»£ç ä¸­ï¼Œå¹¶æ²¡æœ‰æµ‹è¯•**Header ç»„ä»¶è¾“å…¥å List ç»„ä»¶æ˜¯å¦æœ‰å¢åŠ **è¿™åŠŸèƒ½ï¼Ÿ

æ‰€ä»¥è¿™é‡Œå°±éœ€è¦å€ŸåŠ©é›†æˆæµ‹è¯•æ¥æµ‹è¯•ä¸€ä¸‹ä¸¤ä¸ªç»„ä»¶ç»„åˆåï¼Œæ•´ä¸ªåº”ç”¨çš„åŠŸèƒ½æ­£ä¸æ­£å¸¸ï¼š

```ts
// App.resolved.test.tsx
import React from 'react';
import { render, fireEvent, act, RenderResult } from '@testing-library/react';
import App from '../../App';
import axios from 'axios';

jest.mock('axios');
axios.get.mockResolvedValue({
  data: {
    code: 200,
    data: [
      {
        status: 'div',
        value: 'å­¦ä¹  Jest'
      },
      {
        status: 'div',
        value: 'å­¦ä¹  Enzyme'
      },
      {
        status: 'div',
        value: 'å­¦ä¹  Testing-Library'
      }
    ],
    message: 'success'
  }
});

let wrapper: RenderResult;
let headerInput: HTMLInputElement;
let count: HTMLDivElement;
let list: HTMLLIElement[];
let input: HTMLInputElement[];
let deleteBtn: HTMLDivElement[];

// è¿è¡Œæ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å‰å…ˆæ¸²æŸ“ç»„ä»¶
beforeEach(async () => {
  await act(async () => {
    wrapper = render(<App />);
  });
  headerInput = wrapper.getByTestId('header-input') as HTMLInputElement;
  count = wrapper.queryByTestId('count') as HTMLDivElement;
  list = wrapper.queryAllByTestId('list-item') as HTMLLIElement[];
  input = wrapper.queryAllByTestId('input') as HTMLInputElement[];
  deleteBtn = wrapper.queryAllByTestId('delete-item') as HTMLDivElement[];
});

// è¿è¡Œåé‡ç½®
afterEach(() => {
  wrapper = null;
  headerInput = null;
  count = null;
  list = [];
  input = [];
  deleteBtn = [];
});

describe('App ç»„ä»¶ï¼ˆè¯·æ±‚æˆåŠŸæ—¶ï¼‰', () => {
  it('ç»„ä»¶åˆå§‹åŒ–æ­£å¸¸', () => {
    // headerInput å­˜åœ¨
    expect(headerInput).not.toBeNull();

    // ç»„ä»¶åˆå§‹åŒ– headerInput value ä¸ºç©º
    expect(headerInput.value).toEqual('');

    // è®¡æ•°å™¨å­˜åœ¨ä¸”æ•°å€¼ä¸º 3
    expect(count).not.toBeNull();
    expect(count.textContent).toEqual('3');

    // åˆ—è¡¨é¡¹ä¸ä¸ºç©ºä¸”é•¿åº¦ä¸º 3
    expect(list).toHaveLength(3);

    // æ²¡æœ‰åˆ—è¡¨é¡¹å¤„äºç¼–è¾‘çŠ¶æ€
    expect(input).toHaveLength(0);
  });

  it('è¾“å…¥æ¡†æäº¤ååˆ—è¡¨é¡¹åº”è¯¥å¢åŠ ', () => {
    fireEvent.change(headerInput, {
      target: { value: 'åˆ†äº«è‡ªåŠ¨åŒ–æµ‹è¯•å­¦ä¹ æˆæœ' }
    });
    fireEvent.keyUp(headerInput, { keyCode: 13 });

    expect(count.textContent).toEqual('4');
    // ä¼šè§¦å‘ DOM å˜åŒ– éœ€é‡æ–°æŸ¥è¯¢ä¸€æ¬¡
    list = wrapper.queryAllByTestId('list-item') as HTMLLIElement[];
    expect(list).toHaveLength(4);

    // æœ€åä¸€é¡¹çš„å†…å®¹ä¸ºæ·»åŠ çš„å†…å®¹
    expect(list[3]).toHaveTextContent('åˆ†äº«è‡ªåŠ¨åŒ–æµ‹è¯•å­¦ä¹ æˆæœ');
  });

  it('åˆ—è¡¨é¡¹åˆ é™¤ååº”è¯¥èƒ½å‡å°‘', () => {
    fireEvent.click(deleteBtn[2]);

    expect(count.textContent).toEqual('2');
    // ä¼šè§¦å‘ DOM å˜åŒ– éœ€é‡æ–°æŸ¥è¯¢ä¸€æ¬¡
    list = wrapper.queryAllByTestId('list-item') as HTMLLIElement[];
    expect(list).toHaveLength(2);
  });

  it('åˆ—è¡¨é¡¹åº”è¯¥èƒ½ç¼–è¾‘å¹¶æäº¤', () => {
    fireEvent.click(list[2]);
    const editingItemInput = list[2].querySelector(
      '[data-testid="input"]'
    ) as HTMLInputElement;

    // ç¬¬ä¸€ äºŒé¡¹æœªå¤„äºç¼–è¾‘çŠ¶æ€ ç¬¬ä¸‰é¡¹å¤„äºç¼–è¾‘çŠ¶æ€
    expect(list[0].querySelector('[data-testid="input"]')).toBeNull();
    expect(list[1].querySelector('[data-testid="input"]')).toBeNull();
    expect(editingItemInput).not.toBeNull();

    // ç¬¬ä¸‰é¡¹è¾“å…¥
    fireEvent.change(editingItemInput, {
      target: { value: 'Learn Testing Library' }
    });
    expect(editingItemInput.value).toEqual('Learn Testing Library');

    // å¤±ç„¦åå†…å®¹è¢«æ”¹å˜
    fireEvent.blur(editingItemInput);
    expect(list[2]).toHaveTextContent('Learn Testing Library');
  });
});
```

è®¤çœŸçœ‹äº†ä»£ç çš„åŒå­¦å¯èƒ½ä¼šå¯¹è¿™äº›ä»£ç æ„Ÿåˆ°ç–‘æƒ‘ï¼š

```ts
// mock api
jest.mock('axios');
axios.get.mockResolvedValue({
  data: {
    code: 200,
    data: [
      {
        status: 'div',
        value: 'å­¦ä¹  Jest'
      },
      {
        status: 'div',
        value: 'å­¦ä¹  Enzyme'
      },
      {
        status: 'div',
        value: 'å­¦ä¹  Testing-Library'
      }
    ],
    message: 'success'
  }
});
```

```ts
// async render
await act(async () => {
  wrapper = render(<App />);
});
```

å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨ä¸­ç”¨åˆ°äº† `axios` æ¥è¯·æ±‚æœ¬åœ°æ•°æ®ï¼Œæœ€ç»ˆå‘ˆç°åœ¨é¡µé¢ä¸Šã€‚

åœ¨å®é™…çš„å¼€å‘å½“ä¸­è‚¯å®šæ˜¯è°ƒç”¨åç«¯ç»™çš„æ¥å£æ¥è·å–æ•°æ®æˆ–å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œè¿™å°±å¼•å‡ºäº†å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼š**æµ‹è¯•ä»£ç ä¸èƒ½å¯¹ä¸šåŠ¡ä»£ç äº§ç”Ÿä¾µå…¥æ€§ï¼**

äº‹å®ä¸Šè¿™ä¸ª**ä¾µå…¥æ€§**ä¸åªæ˜¯**å¯¹ä¸šåŠ¡ä»£ç çš„ä¾µå…¥**ï¼Œè¿˜æœ‰**å¯¹åç«¯æ¥å£çš„ä¾µå…¥**ã€‚

ä¸Šé¢ `mock api` çš„ä»£ç ï¼Œå…¶å®å°±æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒä¸‹æ¨¡æ‹Ÿä¸€ä¸ªæ¥å£çš„è¿”å›å€¼ï¼Œå› ä¸º `axios` çš„ `get` æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª `Promise`ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿåº”è¯¥è°ƒç”¨ `mockResolvedValue` æ¥æ¨¡æ‹Ÿæ¥å£ `resolve` çŠ¶æ€çš„ç»“æœã€‚

åé¢çš„ `async render` å…¶å®ä¹Ÿæ˜¯ä¸ºè¿™ä¸ª `axios` æœåŠ¡çš„ï¼Œå› ä¸º `axios` è¯·æ±‚æ¥å£æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨åŒæ­¥çš„æ–¹å¼æ¥æ¸²æŸ“ï¼Œå¼‚æ­¥äº‹ä»¶ä¼šè¢«æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ°åŒæ­¥çš„ä»£ç æ‰§è¡Œå®Œæˆã€‚

è¿™æ ·çš„è¯å°±ä¼šå‡ºç°å¼‚æ­¥äº‹ä»¶è¿˜æ²¡æ‰§è¡Œï¼Œæµ‹è¯•ç”¨ä¾‹å°±å·²ç»è·‘å®Œäº†çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´æµ‹è¯•å¯èƒ½ä¸é€šè¿‡ã€‚

å½“ç„¶ï¼Œè¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿäº†æ¥å£ `resolve` çš„çŠ¶æ€ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ª `App.rejected.test.tsx` æ–‡ä»¶ï¼Œæ¥æµ‹è¯•æ¥å£ `reject` çš„çŠ¶æ€ï¼ˆå®é™…å¼€å‘ä¸­ï¼Œæ¥å£ `reject` å¯èƒ½ä¹Ÿéœ€è¦ä¸€ä¸ªå‹å¥½çš„æç¤ºï¼‰ã€‚

#### å•å…ƒæµ‹è¯• & é›†æˆæµ‹è¯•ï¼ˆEnzymeï¼‰

é™¤äº† `React` å®˜æ–¹æ¨èçš„ `Testing-Library`ï¼Œ`Airbnb` å…¬å¸ä¹Ÿæ¨å‡ºäº†ä¸€æ¬¾æµ‹è¯•æ¡†æ¶ `Enzyme`ï¼ŒåŒæ ·ä¹Ÿæ˜¯éå¸¸å¥½ç”¨çš„ä¸€æ¬¾æµ‹è¯•æ¡†æ¶ï¼Œè®¾è®¡æ€æƒ³ç•¥æœ‰ä¸åŒï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åˆ°è¿™ä¸ªé¡¹ç›®çš„ GitHub ä»“åº“æŸ¥çœ‹ï¼Œè®°å¾—åˆ‡æ¢åˆ° `advance/enzyme` åˆ†æ”¯ã€‚

`Enzyme` çš„ä»£ç å°±æ˜¯å®Œå…¨ç”± Dell è€å¸ˆç¼–å†™çš„äº†ï¼Œè¿™é‡Œä»…ä¾›å¤§å®¶å‚è€ƒå­¦ä¹ ~

#### å•å…ƒæµ‹è¯•ï¼ˆHooks ç›¸å…³ï¼‰

åœ¨ä½¿ç”¨ `React Hooks` å¼€å‘çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¼šå°†ä¸€äº›é‡å¤é€»è¾‘æŠ½ç¦»æˆå…¬å…±çš„ `Hooks`ï¼Œè¿™å…¬å…± `Hooks` çš„å¯é æ€§ä¹Ÿå¾ˆé‡è¦ï¼Œ`Testing-Library` è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸“é—¨ç”¨äºæµ‹è¯• `React Hooks` çš„å·¥å…·ï¼š[`react-hooks-testing-library`](https://github.com/testing-library/react-hooks-testing-library)

## å‚è€ƒèµ„æ–™

- [Dell Leeï¼šå‰ç«¯è¦å­¦çš„æµ‹è¯•è¯¾ ä» Jest å…¥é—¨åˆ° TDD/BDD åŒå®æˆ˜](https://coding.imooc.com/learn/list/372.html)
- [jest-dom å®˜æ–¹æ–‡æ¡£](https://github.com/testing-library/jest-dom)
- [react-testing-library å®˜æ–¹æ–‡æ¡£](https://github.com/testing-library/react-testing-library)
- [Enzyme å®˜æ–¹æ–‡æ¡£](https://enzymejs.github.io/enzyme/)
